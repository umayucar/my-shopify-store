{% if collection.metafields.custom.related_blog_posts.value %}
{{ 'component-accordion.css' | asset_url | stylesheet_tag }}
{{ 'collapsible-content.css' | asset_url | stylesheet_tag }}

{%- style -%}
  .section-{{ section.id }}-padding {
    padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
    padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
  }

  @media screen and (min-width: 750px) {
    .section-{{ section.id }}-padding {
      padding-top: {{ section.settings.padding_top }}px;
      padding-bottom: {{ section.settings.padding_bottom }}px;
    }
  }

  /* Slider container */
  .blog-slider-container {
    position: relative;
    margin-top: 20px;
  }

  /* Slider stilleri */
  .blog-list-container {
    display: flex;
    overflow-x: auto;
    scroll-behavior: smooth;
    gap: 20px;
    padding: 10px 0;
    scrollbar-width: none; /* Firefox */
    -ms-overflow-style: none; /* IE ve Edge */
  }

  .blog-list-container::-webkit-scrollbar {
    display: none; /* Chrome, Safari, Opera */
  }

  /* Blog kart stilleri */
  .blog-card {
    position: relative;
    overflow: hidden;
    margin: 0;
    padding: 0;
    flex: 0 0 calc(33.333% - 14px); /* 3'lü grid için */
    min-width: 280px;
    scroll-snap-align: start;
  }
  
  .blog-card-image {
    width: 100%;
    height: 250px;
    overflow: hidden;
    margin: 0;
    padding: 0;
  }
  
  .blog-card-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
    transition: transform 0.3s ease;
    margin: 0;
    padding: 0;
    border: none;
  }
  
  .blog-card:hover img {
    transform: scale(1.05);
  }
  
  .blog-card-content {
    padding: 15px;
    background: #fff;
    display: flex;
    flex-direction: column;
    height: calc(100% - 250px);
  }
  
  .blog-card-title {
    margin-top: 0;
    margin-bottom: 10px;
    font-size: 18px;
    flex-grow: 0;
  }
  
  .blog-card-excerpt {
    margin-bottom: 15px;
    color: #666;
    flex-grow: 1;
  }
  
  .blog-card-link {
    display: inline-block;
    padding: 8px 16px;
    background: #000;
    color: #fff;
    text-decoration: none;
    border-radius: 4px;
    font-weight: 500;
    text-align: center;
    margin-top: auto;
    flex-shrink: 0;
  }

  /* Slider navigation buttons */
  .slider-buttons {
    display: flex;
    justify-content: center;
    gap: 15px;
    margin-top: 20px;
  }

  .slider-button {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: #000;
    color: #fff;
    border: none;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background-color 0.3s ease;
  }

  .slider-button:hover {
    background: #333;
  }

  .slider-button:disabled {
    background: #ccc;
    cursor: not-allowed;
  }

  .slider-button svg {
    width: 20px;
    height: 20px;
  }

  /* Responsive */
  @media (max-width: 989px) {
    .blog-card {
      flex: 0 0 calc(50% - 10px); /* 2'li grid için */
    }
  }

  @media (max-width: 749px) {
    .blog-card {
      flex: 0 0 calc(100% - 20px); /* 1'li grid için */
    }
    
    .slider-buttons {
      display: none; /* Mobilde butonları gizle */
    }
  }
{%- endstyle -%}

<div class="custom-collection-slider color-{{ section.settings.color_scheme }} gradient">
  <div class="collection-list-wrapper page-width isolate section-{{ section.id }}-padding">
    {%- unless section.settings.title == blank -%}
      <div class="title-wrapper-with-link title-wrapper--self-padded-mobile title-wrapper--no-top-margin">
        <h2
          id="SectionHeading-{{ section.id }}"
          class="collection-list-title inline-richtext {{ section.settings.heading_size }}"
        >
          {{ section.settings.title }}
        </h2>
      </div>
    {%- endunless -%}

    {%- assign collection_list = collection.metafields.custom.related_blog_posts.value -%}

    {% if collection_list %}
      <div class="blog-slider-container">
        <div class="blog-list-container" id="blog-slider-{{ section.id }}">
          {%- for blog in collection_list -%}
            <div class="blog-card">
              {% if blog.image %}
                <div class="blog-card-image">
                  <img 
                    src="{{ blog.image | img_url: '480x480', crop: 'center' }}" 
                    width="480" 
                    height="480" 
                    alt="{{ blog.title }}"
                    loading="lazy"
                  >
                </div>
              {% endif %}
              <div class="blog-card-content">
                <h3 class="blog-card-title">{{ blog.title }}</h3>
                <div class="blog-card-excerpt">
                  {{ blog.excerptt | strip_html | truncatewords: 20 }}
                </div>
                {%- capture blog_url -%}
                  https://umay-test.myshopify.com{{ blog.system.url }}
                {%- endcapture -%}
                <a href="{{ blog_url | strip }}" class="blog-card-link">Read More</a>
              </div>
            </div>
          {%- endfor -%}
        </div>

        {% if collection_list.size > 3 %}
          <div class="slider-buttons">
            <button class="slider-button prev-button" onclick="slideBlog('prev', '{{ section.id }}')" aria-label="Previous slide">
              <svg viewBox="0 0 24 24" fill="currentColor">
                <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/>
              </svg>
            </button>
            <button class="slider-button next-button" onclick="slideBlog('next', '{{ section.id }}')" aria-label="Next slide">
              <svg viewBox="0 0 24 24" fill="currentColor">
                <path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/>
              </svg>
            </button>
          </div>
        {% endif %}
      </div>
    {% else %}
      <p>No related blog posts found.</p>
    {% endif %}
  </div>
</div>

<script>
function slideBlog(direction, sectionId) {
  const slider = document.getElementById(`blog-slider-${sectionId}`);
  const cardWidth = slider.querySelector('.blog-card').offsetWidth + 20; // card width + gap
  const scrollAmount = cardWidth * (direction === 'next' ? 1 : -1);
  
  slider.scrollBy({
    left: scrollAmount,
    behavior: 'smooth'
  });
}

// Slider butonlarını scroll durumuna göre disable et
document.addEventListener('DOMContentLoaded', function() {
  const sliders = document.querySelectorAll('.blog-list-container');
  
  sliders.forEach(slider => {
    slider.addEventListener('scroll', function() {
      const sectionId = this.id.split('-')[2];
      const prevButton = document.querySelector(`#blog-slider-${sectionId} ~ .slider-buttons .prev-button`);
      const nextButton = document.querySelector(`#blog-slider-${section.id} ~ .slider-buttons .next-button`);
      
      if (prevButton && nextButton) {
        prevButton.disabled = this.scrollLeft <= 0;
        nextButton.disabled = this.scrollLeft + this.offsetWidth >= this.scrollWidth - 1;
      }
    });
  });
});
</script>
{% endif %}

{% schema %}
{
  "name": "Collection Related Blogs",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "inline_richtext",
      "id": "title",
      "label": "Section heading",
      "default": "Related Blog Posts"
    },
    {
      "type": "select",
      "id": "heading_size",
      "label": "Heading size",
      "options": [
        { "value": "h2", "label": "H2" },
        { "value": "h1", "label": "H1" },
        { "value": "h0", "label": "H0" }
      ],
      "default": "h2"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Section color scheme",
      "default": "scheme-1"
    },
    {
      "type": "range",
      "id": "padding_top",
      "label": "Padding top",
      "min": 0, "max": 100, "step": 4, "unit": "px",
      "default": 36
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "label": "Padding bottom",
      "min": 0, "max": 100, "step": 4, "unit": "px",
      "default": 36
    }
  ],
  "presets": [
    {
      "name": "Collection Related Blogs"
    }
  ]
}
{% endschema %}